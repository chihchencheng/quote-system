<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>內部估價單系統</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    label, select, input { margin: 5px 0; display: block; }
    button { margin-top: 10px; padding: 8px 12px; background: #3498db; color: white; border: none; cursor: pointer; }
    button:hover { background: #2980b9; }
  </style>
</head>
<body>
  <h1>報價單產生器</h1>

  <label for="product">選擇產品：</label>
  <select id="product"></select>

  <label for="qty">輸入數量：</label>
  <input type="number" id="qty" min="1" value="1">

  <button onclick="generateQuote()">產生估價單 PDF</button>

  <script>
    // === 換成你自己的 Google Apps Script API 網址 ===
    const API_URL = "https://script.google.com/macros/s/AKfycbwSTu4M5gsHB_vP1pdAHsmXbkQtMF6lhTLT17Y1zepfXEtoUgkOQHK7Vto7gNcfWaGDXw/exec";

    let productList = [];

    // 初始化：讀取產品清單
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        productList = data;
        const select = document.getElementById('product');
        data.forEach(item => {
          let opt = document.createElement('option');
          opt.value = item["單價"];
          opt.text = `${item["產品名稱"]} - $${item["單價"]}`;
          select.add(opt);
        });
      })
      .catch(err => alert("讀取產品資料失敗，請確認 API_URL 是否正確"));

    // 產生 PDF 報價單
    function generateQuote() {
      const { jsPDF } = window.jspdf;

      const select = document.getElementById('product');
      const qty = parseInt(document.getElementById('qty').value);
      const productName = select.options[select.selectedIndex].text;
      const unitPrice = parseFloat(select.value);
      const total = unitPrice * qty;

      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("估價單", 90, 20);

      doc.setFontSize(12);
      doc.text(`產品：${productName}`, 20, 40);
      doc.text(`數量：${qty}`, 20, 50);
      doc.text(`單價：$${unitPrice}`, 20, 60);
      doc.text(`總價：$${total}`, 20, 70);

      doc.save("估價單.pdf");
    }
  </script>
</body>
</html>
